#creates artifacts on version tag
name: '$(TeamProject)-$(BuildDefinitionName)[$(SourceBranchName)] du $(Date:dd.MM.yyyy) a $(Date:HH)h$(Date:mm)m$(Date:ss)s'

# Waits for standard build to avoid publishing if build fails
resources:
  pipelines:
    - pipeline: build   # Name of the pipeline resource
      source: ci-build # Name of the triggering pipeline
      trigger:
        tags:
          include:
            - release/*

variables:
  - template: variables.yml

stages:

  - template: platform-stage-tmpl.yml
    parameters:
      name: LinuxArtifacts
      steps:
        - template: cd-publish-tmpl.yml
          parameters:
            runtime: $(runtime_linux)
            includeNotesTemplate: true

  - template: platform-stage-tmpl.yml
    parameters:
      name: MacArtifacts
      steps:
        - template: cd-publish-tmpl.yml
          parameters:
            runtime: $(runtime_mac)

  - template: platform-stage-tmpl.yml
    parameters:
      name: WindowsArtifacts
      steps:
        - template: cd-publish-tmpl.yml
          parameters:
            runtime: $(runtime_windows)
